import{E as L,g as l,t as u,a as c,b as m,c as O,d as I,e as R,T as D,f as v,r as S,h as b}from"./vendor.0afd9346.js";const j=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}};j();var g;(function(s){s[s.IDLE=0]="IDLE",s[s.LOADING=1]="LOADING",s[s.LOADED=2]="LOADED",s[s.ERROR=3]="ERROR",s[s.EMPTY=4]="EMPTY"})(g||(g={}));var a=g;class T extends L{constructor(o){super();this.type="canvas",this._options=o,this._projection=l(o.projection),this._imageExtent=o.imageExtent,this._initCoordinates(),this._loadImage()}_initCoordinates(){const{projection:o,imageExtent:n}=this._options,e=u(n,o,"EPSG:4326");this.coordinates=[[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]}_loadImage(){const{crossOrigin:o,url:n}=this._options,e=new Image;o&&(e.crossOrigin=o),e.src=n,e.src&&typeof Image!="undefined"&&Image.prototype.decode&&e.decode().then(()=>this._handleImageLoad()).catch(i=>{console.error(i),this._handleImageError()}),this._imageState=a.IDLE,this._image=e}_handleImageLoad(){this.getResolution()===void 0&&(this._resolution=c(this._options.imageExtent)/this._image.height),this._imageState=a.LOADED,this._handleImageChange()}_handleImageError(){this._imageState=a.ERROR}_handleImageChange(){this.getImageState()==a.LOADED&&this._reprojectImage()}_reprojectImage(){const o=this.getProjection(),n=l("EPSG:3857"),e=u(this._imageExtent,o,n),t=m(e)/this._image.width,i=c(e)/this._image.height,r=Math.max(t,i);this._reproject(o,n,e,r)}_reproject(o,n,e,t){if(this.getImageState()==a.LOADED){const i=o.getExtent(),r=n.getExtent(),p=m(e)/t,f=c(e)/t,E=1,d=r?O(e,r):e,_=I(d),y=R(o,n,_,t),x=new D(o,n,d,i,y*v,t);this.canvas=S(p,f,E,this.getResolution(),i,t,e,x,[{extent:this._options.imageExtent,image:this._image}],0),this.dispatchEvent(b.LOAD)}}getProjection(){return this._projection}getImageState(){return this._imageState}getResolution(){return this._resolution}}mapboxgl.accessToken="pk.eyJ1IjoiaHVhbmdsaWkiLCJhIjoiY2ptbjJsZXRsMHBlNzNsbGIycTk3eWU0biJ9.Pj_8_ER8nD7UQSSeOg4JZA";const h=new mapboxgl.Map({container:"map",style:"mapbox://styles/huanglii/ckqt08oxg1kcc18ub9vowurqd?optimize=true",bounds:[[105.289838,32.204171],[110.195632,28.164713]],fitBoundsOptions:{padding:{top:50,bottom:50,left:50,right:50}}});h.on("load",()=>{new T({crossOrigin:"anonymous",url:"./4326.png",projection:"EPSG:4326",imageExtent:[105.289838,28.164713,110.195632,32.204171]}).addEventListener("load",o=>{h.addSource("canvas-source",o.target),h.addLayer({id:"canvas-layer",type:"raster",source:"canvas-source"},"waterway")})});
